# 本地证书(SSL)配置 {docsify-ignore}

### 案发现场

现代浏览器(当时用的是最新版谷歌)的安全性，毋庸置疑，在本地跨域请求，也需要配置 `SSL` 证书，否则就会导致 `Set-Cookie` 无法使用，也试过网上提到的，配置启动参数，比如 `--args --disable-web-security --user-data-dir=D:\ChromeUserData` 仍旧被拒。当然，通过其他方式验证会话信息，应该还是可行的吧。反正，我之前就采用自定义头参数传输密钥验证用户登录，没出过什么问题。

为此，折腾了一番，在同事的指导下，还是顺利构建了本地的 `HTTPS` 服务。其中，项目那边也有一些坑，就略过了。刚开始，我是直接采用 `OpenSSL` 工具自签证书，浏览器提示证书不是这儿错误就是那儿错误，真的是，搞裂开了。

突然，想起，之前，有朋友，需要对接微信的一些接口，也需要本地域名为`HTTPS`。这更加坚定了，我整理这个的决心。

### 依赖工具

不得不感叹一句，现成的真香。主要就是采用[mkcert](https://github.com/FiloSottile/mkcert)工具，帮助我们生成根证书，以及相应的域名证书，这样就避免不少的细节问题。我想，通过 `OpenSSL` 应该也能够做到的，但各种细节参数之类的，就相对比较麻烦。不过，作为业余研究的话，我还是比较推荐的。

对于该工具的安装和使用，仓库中的[README.md](https://github.com/FiloSottile/mkcert/blob/master/README.md)也讲的比较清楚了。其中关于 `choco` 的安装，我个人仓库中，有相应文件，有需要的朋友，可前往自取。

下面，就说一下，我个人的操作吧。当然，也可以直接忽略。

### 生成证书

#### 根证书

使用超管模式打开终端，输入 `mkcert -install` 指令生成本地根证书。需要查看根证书的位置，可以输入 `mkcert -CAROOT` 指令。

#### 域名证书

直接输入 `mkcert example.com(需要部署的域名)` 指令即可，默认在当前目录生成证书文件。当然，这里，需要做好域名和IP的本地解析，主要修改的文件就是 `C:\Windows\System32\drivers\etc\hosts`，这个我就不展开了，也就那样。

#### 注意事项

在客户端安装证书时，需要服务方提供 `crt` 文件，这里直接将根证书和域名证书( `.pem` 后缀，不含 `key` 关键字那个)复制一份，将其后缀改为 `.crt` ，在 `Win` 系统上，双击即可安装，需要注意的是，在安装**根证书**，选择证书存储时，需要选择 `受信任的根证书颁发机构` 。

### 证书部署

#### 服务端

由于我这里采用的是 `golang-gin`，直接调用`http.server.ListenAndServeTLS()` 方法，传入证书文件即可。

#### 客户端

即前端，需要导入对应证书，即双击服务方提供的 `crt` 后缀文件，其中根证书需要安装到 `受信任的根证书颁发机构` 。另外还要配置域名指向服务端的局域网IP。上面已经有提及。